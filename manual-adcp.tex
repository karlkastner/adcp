\documentclass[11pt,twoside,a4paper]{article}
%{book}

% This is an automatically generated file.
% Do not edit it.
% Changes to this file are not preserved!

\usepackage{tocloft}
\usepackage{hyperref}
\usepackage{listings}
\lstset{
basicstyle=\small\ttfamily,
columns=flexible,
breaklines=true
}
\setlength{\cftsubsecnumwidth}{3.5em}

\title{Manual for Package:
adcp\protect\\Revision 4M
}
\author{Karl K\"astner}
%\date{}

\begin{document}

\maketitle

\tableofcontents

% licence
% abstract


\section{@ADCP}
\subsection{ADCP}
${}$
\begin{lstlisting}
 ADCP superclass
 converts ADCP fixed integer raw data to floats with SI units
 provides functions for ADCP data manipulation
 calculated from the water temperature and sound frequency

\end{lstlisting}
\subsection{Ds}
${}$
\begin{lstlisting}
 depth of bin, distance between water surface (z_s) and (z_i)

 Ds = z_s - z_bin

 does not correct for tilts

\end{lstlisting}
\subsection{Dt}
${}$
\begin{lstlisting}
 projected distance from transducer to cell centres
 if the instrument is not tilted, this is the vertical distance (depth)
 between the transducer and cell centres
 does not account for transducer depth

\end{lstlisting}
\subsection{R}
${}$
\begin{lstlisting}
 unprojected (slanted) distance between the transducer and cell centres

\end{lstlisting}
\subsection{adc\_current\_slope}
${}$
\begin{lstlisting}
 instrument type specific slope for converting raw current to Ampere
 c.f WorkHorse Commands and Output Data Format, March 2014
 c.f. XMT Voltage and Current Channels
 originally undoccumented by RDI, and taken from Shields 2010

\end{lstlisting}
\subsection{adc\_voltage\_slope}
${}$
\begin{lstlisting}
 instrument series specific conversion factors for voltage
 c.f. WorkHorse Commands and Output Data Format, March 2014
 c.f. XMT Voltage and Current Channels
 originally undoccumented by RDI, and taken from Shields 2010

\end{lstlisting}
\subsection{assign\_file}
${}$
\begin{lstlisting}
 ensemble indices of each file

\end{lstlisting}
\subsection{assign\_water\_level}
${}$
\begin{lstlisting}
 assign water level to adcp ensembles (combine gauge with boat data)

\end{lstlisting}
\subsection{average\_profile}
${}$
\begin{lstlisting}
 average backscatter for each sample within an specific interval

\end{lstlisting}
\subsection{backscatter2ssc}
${}$
\begin{lstlisting}
 wrapper for backscatter conversion

\end{lstlisting}
\subsection{binsize}
${}$
\begin{lstlisting}
 bin size (vertical distance between two bins)

\end{lstlisting}
\subsection{blnk}
${}$
\begin{lstlisting}
 blanking range, range from transduce to centre of first bin

\end{lstlisting}
\subsection{btrange}
${}$
\begin{lstlisting}
 convert raw btrange to vertical distance (projected distance) of the bed
 level below the transducer, when the transducer is looking vertically down
 this is the depth less the transducer depth

\end{lstlisting}
\subsection{calc\_backscatter}
${}$
\begin{lstlisting}
 backscatter from echo intensity

\end{lstlisting}
\subsection{clock\_offset\_STATIC}
${}$
\begin{lstlisting}
 dt : median difference between adcp clock and UTC
 sd_dt : standard error of dt

\end{lstlisting}
\subsection{convert\_raw\_binprops\_STATIC}
${}$
\begin{lstlisting}
 convert the raw bin properties to si-units

\end{lstlisting}
\subsection{convert\_raw\_serial\_STATIC}
${}$
\begin{lstlisting}
 convert bytes of serial number into single number
 big endian system

\end{lstlisting}
\subsection{convert\_raw\_time\_STATIC}
${}$
\begin{lstlisting}
 convert measurement time stamps into matlab internal format

\end{lstlisting}
\subsection{convert\_raw\_velocity}
${}$
\begin{lstlisting}
 convert scaled integer raw velocity to float SI (m/s)

\end{lstlisting}
\subsection{convert\_raw\_velocity\_STATIC}
${}$
\begin{lstlisting}
 convert raw velocity to SI units (m/s)

\end{lstlisting}
\subsection{copy}
${}$
\begin{lstlisting}
 copy constructor

\end{lstlisting}
\subsection{distmidbin1}
${}$
\begin{lstlisting}
 convert raw distance to first bin centre to SI

\end{lstlisting}
\subsection{file\_ensemble\_index}
${}$
\begin{lstlisting}
 ensemble index eid_f with respect to file for ensemble eid

\end{lstlisting}
\subsection{file\_index}
${}$
\begin{lstlisting}
 first and last ensemble index of of a file

\end{lstlisting}
\subsection{filetime\_min}
${}$
\begin{lstlisting}
 start time of each file

\end{lstlisting}
\subsection{fill\_coordinate\_gaps}
${}$
\begin{lstlisting}
 fill gaps in ensemble coordinates

\end{lstlisting}
\subsection{filter\_range}
${}$
\begin{lstlisting}
 filter HADCP velocity by detecting the last valid bin
 if the bacscatter does not decreas over 10 bins, than obtstacle or intersection

\end{lstlisting}
\subsection{heading\_rad}
${}$
\begin{lstlisting}
 convert raw instrument heading angle to [rad]

\end{lstlisting}
\subsection{instrument\_depth\_m}
${}$
\begin{lstlisting}
 depth of instrument (for submerged deployments)

\end{lstlisting}
\subsection{instrument\_to\_ship\_STATIC}
${}$
\begin{lstlisting}
 transform velocities from instrument reference to ship reference
 by correcting for pitch_rad and roll_rad

 input
 vel   : float [arbitrary unit] instrument reference
 btvel : float [arbitrary unit] instrument reference
 pitch_rad : float [radians] true pitch_rad, not measured pitch_rad
 roll_rad  : float [radians]
 
 output
 vel and btvel [input unit] ship reference

\end{lstlisting}
\subsection{lngthtranspulse}
${}$
\begin{lstlisting}
 convert raw transmit pulse length to SI units (m)

\end{lstlisting}
\subsection{load\_RSSI\_values\_STATIC}
${}$
\begin{lstlisting}
 load instrument specific backscatter conversion parameters

\end{lstlisting}
\subsection{nbins}
${}$
\begin{lstlisting}
 number of bins for each file

\end{lstlisting}
\subsection{near\_field\_correction}
${}$
\begin{lstlisting}
 new fiel correction of the acoustic backscatter
 c.f. wall 2006
 Psi : (nr,1)  near field correction factor

\end{lstlisting}
\subsection{nens}
${}$
\begin{lstlisting}
 number of ensembles

\end{lstlisting}
\subsection{pitch\_rad}
${}$
\begin{lstlisting}
 convert raw pitch to radians

\end{lstlisting}
\subsection{pressure\_bar}
${}$
\begin{lstlisting}
 convert raw pressure to bar

\end{lstlisting}
\subsection{range2binid}
${}$
\begin{lstlisting}
 convert distance to transducer to bin index

\end{lstlisting}
\subsection{roll\_rad}
${}$
\begin{lstlisting}
 convert raw instrument roll angle to [rad]

\end{lstlisting}
\subsection{rotate\_velocity}
${}$
\begin{lstlisting}
 rotate the velocity in the horizontal plane with respect to the directional
 vector dir
 dir : direction of the transect

\end{lstlisting}
\subsection{rotate\_velocity\_sw}
${}$
\begin{lstlisting}
 rotate velocity to local streamwise reference
 input velocity can have arbitrary reference

\end{lstlisting}
\subsection{ship\_to\_earth\_STATIC}
${}$
\begin{lstlisting}
 converts velocity from ship to earth coordinate reference
 expects input arguments informat:
 vel    : float arbitrary unit
 btvel  : float same unit as vel
 heading_rad: float [radians]


\end{lstlisting}
\subsection{sort\_STATIC}
${}$
\begin{lstlisting}
 sort files by start time

\end{lstlisting}
\subsection{squeeze\_STATIC}
${}$
\begin{lstlisting}
 cut ensembles, skip ensembles or average ensembles in time

 adcp : adcp structure
 dt   : time between output ensembles in seconds
 mode : {'average', 'skip'}
 mask : selection of ensembles to keep (computed from dt if not provided)
				fprintf(1,'Progress: %g\n%% %gs\n',idx/nt,tlast);

\end{lstlisting}
\subsection{temperature\_offset\_C}
${}$
\begin{lstlisting}
 instrument specific temperature offset

\end{lstlisting}
\subsection{to\_abs}
${}$
\begin{lstlisting}
 velocity magnitude

\end{lstlisting}
\subsection{transducer\_temperature\_C}
${}$
\begin{lstlisting}
 convert raw transducer temperature to SI units [Celsius]
 T   : (1,nt)  water temperature

\end{lstlisting}
\subsection{verify\_pc\_time}
${}$
\begin{lstlisting}
 verify the time stored in the data file

\end{lstlisting}
\section{@Ensemble}
\subsection{Ensemble}
${}$
\begin{lstlisting}
 container for ADCP ensemble data and properties

\end{lstlisting}
\subsection{calc\_beamcoords}
${}$
\begin{lstlisting}
 claculate positions in world coordinates where the individual beams hit the bottom

\end{lstlisting}
\section{@HADCP}
\subsection{HADCP}
${}$
\begin{lstlisting}
 coverts raw data of horizontal ADCPs into physical quantities
 and provides functions for data processing

\end{lstlisting}
\subsection{beam\_to\_instrument\_STATIC}
${}$
\begin{lstlisting}
 transform the 3 beam velocities into a set of 2 orthogonal velocities
 and 1 error velocity
 This uses always three beams (no two beam solutions)

 input
 vel       : float [arbitrary unit] beam reference system
 btvel     : float [arbitrary unit] beam reference system
 beamangle : float [radians]

 output
 vel and btvel [input unit] instrument reference system

\end{lstlisting}
\subsection{bootstrap\_backscatter}
${}$
\begin{lstlisting}
 bootstrap uncertainty of the backscatter parameters

\end{lstlisting}
\subsection{calc\_beam\_spreading\_cone}
${}$
\begin{lstlisting}
 beam spreading
 Note: beams spread in the form of bessel functions
       this is the engineering approach as cones, which is however not
       a good approximation, it is better to approximate it as a gaussian

\end{lstlisting}
\subsection{calc\_bin\_coordinates}
${}$
\begin{lstlisting}
 get the cartesian (world) coordinates of the HADCP central beam bins

\end{lstlisting}
\subsection{calibrate\_backscatter}
${}$
\begin{lstlisting}
 calibrate backscatter to sediment concentration by the method of Sassi

\end{lstlisting}
\subsection{filter\_velocity}
${}$
\begin{lstlisting}
 filter outliers in velocity data

\end{lstlisting}
\subsection{firmware\_fix\_STATIC}
${}$
\begin{lstlisting}
 correct RDI HADCP firmware bug (2014)
 this bug successively invalids data every 4th-bin, which led to 3-beam solutions
 and consequentially jumps of the transformed velocities
			vel_s(:,fdx,:) = vel(:,fdx,:);
			vel_b(:,fdx,:) = vel(:,fdx,:);

\end{lstlisting}
\subsection{fixnan}
${}$
\begin{lstlisting}
 interpolate invalid bin-samples from last and next ensemble

\end{lstlisting}
\subsection{instrument\_to\_beam\_STATIC}
${}$
\begin{lstlisting}
 transform the 3 beam velocities into a set of 2 orthogonal velocities
 and 1 error velocity
 This uses always three beams (no two beam solutions)

 input
 vel       : float [arbitrary unit] beam reference system
 btvel     : float [arbitrary unit] beam reference system
 beamangle : float [radians]

 output
 vel and btvel [input unit] instrument reference system

 mode : beams used for all transformations
        123, 12, 23, 13

\end{lstlisting}
\subsection{reorder\_velocity\_STATIC}
${}$
\begin{lstlisting}
 reorder the HADCP velocity data into the first three slots, the HADCP
 has just three beams, but the software stores data for
 four beams, similar to the four beam VADCPs

\end{lstlisting}
\subsection{to\_beam\_STATIC}
${}$
\begin{lstlisting}
 wrapper for conversion to beam velocity
 Note that back-conversion to beam velocity is not unique in case of 3 beam
 solutions (as RDI instruments doe not store which beams were used) and
 if instrument internal bin-mapping is used (whichs precise algorithm remains
 an RDI secret)

\end{lstlisting}
\subsection{to\_earth\_STATIC}
${}$
\begin{lstlisting}
 wrappter to transform velocities to world coordinate reference

\end{lstlisting}
\subsection{to\_instrument\_STATIC}
${}$
\begin{lstlisting}
 wrapper to convert velocity to instrument coordinate reference

\end{lstlisting}
\subsection{to\_ship\_STATIC}
${}$
\begin{lstlisting}
 wrapper for conversion to ship velocity

\end{lstlisting}
\section{@RDI\_mmt}
\subsection{RDI\_mmt}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{read}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{write}
${}$
\begin{lstlisting}

\end{lstlisting}
\section{@VADCP}
\subsection{VADCP}
${}$
\begin{lstlisting}
 coverts raw data of vertical ADCPs into physical quantities

\end{lstlisting}
\subsection{assign\_transect}
${}$
\begin{lstlisting}
 assign transect index to ensembles

\end{lstlisting}
\subsection{backscatter\_report}
${}$
\begin{lstlisting}
 human readable output of calibration properties
%	fprintf(['Parameters and uncertainty with respect to 95%% confidence\n']);

\end{lstlisting}
\subsection{beam\_to\_instrument\_STATIC}
${}$
\begin{lstlisting}
 transform the 4 beam velocities into a set of 3 orthogonal velocities
 and 1 error velocity

 input
 vel       : float [arbitrary unit] beam reference system
 btvel     : float [arbitrary unit] beam reference system
 beamangle : float [radians]

 output
 vel and btvel [input unit] instrument reference system

 TODO account for NaNs either by three beam solution or interpolation


\end{lstlisting}
\subsection{bottom\_track\_STATIC}
${}$
\begin{lstlisting}
 compute bottom track coordinates

\end{lstlisting}
\subsection{bscalibrate}
${}$
\begin{lstlisting}
 backscatter to sediment calibration

 calibtation subroutine
 M_ref : sediment concentration calibration values 
 d_k   : depth of virtual reference value K
         (choose close to receiver, but out of near field, e.g. within 2m .. 4m)
 TODO : better documentation of input values
 TODO : rename nk into ik, bacause it is an index and not a length
 TODO rename r_ref and d_k into r_1 and r_2

\end{lstlisting}
\subsection{bsgrid}
${}$
\begin{lstlisting}
 evaluate the objective function at the selected points

\end{lstlisting}
\subsection{bsinvert}
${}$
\begin{lstlisting}
 backscatter inversion


\end{lstlisting}
\subsection{bsjackknife}
${}$
\begin{lstlisting}
 compute the jackknife estimates of the parameters and their covariances

\end{lstlisting}
\subsection{bsjointcalibration}
${}$
\begin{lstlisting}
 calibrate backscatter

\end{lstlisting}
\subsection{btvel\_from\_position}
${}$
\begin{lstlisting}
 determine boat velocity from bottom track, inverse of bottom track

\end{lstlisting}
\subsection{calc\_ssc}
${}$
\begin{lstlisting}
 calculate the backscatter

\end{lstlisting}
\subsection{cdf}
${}$
\begin{lstlisting}
 compute and plot cumulative distribution (cdf) of the velocity components

\end{lstlisting}
\subsection{convert\_nFiles}
${}$
\begin{lstlisting}
 convert coordinates of NMEA-nFiles

\end{lstlisting}
\subsection{correct\_coordinates}
${}$
\begin{lstlisting}
 correct the bottom coordinates for pitch and roll

\end{lstlisting}
\subsection{correct\_for\_platform\_velocity\_STATIC}
${}$
\begin{lstlisting}
 correct for platform (boat) velocity, this is the negative bed velocity

\end{lstlisting}
\subsection{depth\_average\_velocity}
${}$
\begin{lstlisting}
 average the velocity over depth

\end{lstlisting}
\subsection{depth\_integrate}
${}$
\begin{lstlisting}
 depth integrate the velocity to obtain specific discharge

\end{lstlisting}
\subsection{depth\_integrate\_sediment\_discharge}
${}$
\begin{lstlisting}
 depth integrated sediment discharge

\end{lstlisting}
\subsection{filter\_velocity}
${}$
\begin{lstlisting}
 filter the velocity data

\end{lstlisting}
\subsection{fit\_sediment\_concentration\_profile}
${}$
\begin{lstlisting}
 fit_suspended_sediment_concentration_profile(obj,profile_cls,ensmask,nwin)

\end{lstlisting}
\subsection{fit\_velocity\_profile}
${}$
\begin{lstlisting}
 fit velocity profile to the streamwise velocity

\end{lstlisting}
\subsection{map\_z}
${}$
\begin{lstlisting}
 z-mapping, i.e. correct for roll and pitch of instrument

\end{lstlisting}
\section{@VADCP/old}
\subsection{assign\_crossing}
${}$
\begin{lstlisting}

\end{lstlisting}
\section{@VADCP}
\subsection{optstr}
${}$
\begin{lstlisting}
 string of arguments, for file name generation

\end{lstlisting}
\subsection{plot\_track}
${}$
\begin{lstlisting}
 plot the boat track

\end{lstlisting}
\subsection{plot\_velocity\_components}
${}$
\begin{lstlisting}
 plot the velocity components

\end{lstlisting}
\subsection{process}
${}$
\begin{lstlisting}
 process VADCP data

\end{lstlisting}
\subsection{range2depth}
${}$
\begin{lstlisting}
 depth below transducer for individual bins of the beams

\end{lstlisting}
\subsection{rangemask}
${}$
\begin{lstlisting}
 mask all bins in range

\end{lstlisting}
\subsection{to}
${}$
\begin{lstlisting}
 transform velocity to given reference

\end{lstlisting}
\subsection{to\_beam\_STATIC}
${}$
\begin{lstlisting}
 convert velocity data to beam reference

\end{lstlisting}
\subsection{to\_cs}
${}$
\begin{lstlisting}
 transform velocity to cross section references
 cs-velocity is here defined as the velocity orthogonal to the cs 
	% [ 0  1][c -s]=[-s  c]
	% [ 1  0][s  c] [ c  s]

\end{lstlisting}
\subsection{to\_earth\_STATIC}
${}$
\begin{lstlisting}
 transform coordinates to cartesian world reference system (earth)

\end{lstlisting}
\subsection{to\_sw}
${}$
\begin{lstlisting}
 transform velocity with respect to depth averaged streamwise velocity

\end{lstlisting}
\subsection{velocity\_near\_bed}
${}$
\begin{lstlisting}
 velocity near the bed

\end{lstlisting}
\subsection{xy2nts}
${}$
\begin{lstlisting}
 project coordinates onto a single cross section and assign them nz-coordinates at a single cross section
 TODO this should be part of transect

\end{lstlisting}
\section{adcp}
\begin{lstlisting}
adcp : processing of Acoustic Doppler Current Profiler (ADCP) data

Processing in 3 Levels:

Level 0 : Read in of raw-data (externally provided by ADCPtools, Vermeulen et al.)

Level 1 : VADCP, HADCP, SPADCP
	- convert raw data to CI units (m,s,kg)
	- transform velocities to arbitrary coordinate references
	- depth averaging and integration
	- fit velocity profiles
	- convert backscatter to suspended sediment concentration

Level 2 : CrossSection
	- interpolate and integrate for cross sections

Instruction:
	see and run saggau/sanggau_process_discharge for a working example
	to process VADCP discharge at a non-tidal station


\end{lstlisting}
\subsection{ADCP\_Bin}
${}$
\begin{lstlisting}
 ADCP bin (single velocity values)

\end{lstlisting}
\subsection{SPADCP}
${}$
\begin{lstlisting}
 stream pro acoutic current doppler profiler

\end{lstlisting}
\section{cross-section/@ADCP\_Transect}
\subsection{ADCP\_Transect}
${}$
\begin{lstlisting}
 zero dimensional processing of ADCP data
 no resampling, meshing or gridding

\end{lstlisting}
\subsection{assign\_to\_transect}
${}$
\begin{lstlisting}
 assign ensemble to respective transects
 this has a side-effect (writes to) the adcp object,
 but values of induvidial cross sections remain unaffected by each other

\end{lstlisting}
\subsection{compare}
${}$
\begin{lstlisting}
 discharge summary

\end{lstlisting}
\subsection{detect\_crossings}
${}$
\begin{lstlisting}
 detect consecutive navigation of transects (channel crossings)

\end{lstlisting}
\subsection{detect\_crossings\_circling}
${}$
\begin{lstlisting}
 separatate individual navigation of transects,
 for cases when the boat goes in circles and crosses the branches one after
 the other before returning to the original cross section,
 thus the boat does not turn at the other bank to return across the same section
 and always navigates the cross section in the same direction

\end{lstlisting}
\subsection{detect\_crossings\_returning}
${}$
\begin{lstlisting}
 groups the ensembles into transects,
 one transect is defined as all ensembles recorded during the time the boat
 moved from one bank to the other (return is defined as separate transect)

\end{lstlisting}
\subsection{detect\_rounds}
${}$
\begin{lstlisting}
 detect rounds, i.e. when boat returns to initial position

\end{lstlisting}
\subsection{export\_mmt}
${}$
\begin{lstlisting}
 export RDI mmt

\end{lstlisting}
\subsection{extrapolate\_to\_bank}
${}$
\begin{lstlisting}
 extrapolate values to bank

\end{lstlisting}
\subsection{fit}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{integrate\_discharge}
${}$
\begin{lstlisting}
 integrate discharge

 Q  = sum q
 q  = A_n*u_s = h dn us
    = h * [dx, dy]*[-v; u]
    = h * dt * [-ub, -vb] * [-v; u]

 note that uvb * dt is usually more accurate than dx of GPS position,
 if uvb determined by doppler shift of ADCP bottom echo,
 except when the GPS position (or velocity) is determined from the carrier frequency

 note that projection can be left out, if cs is defined with transect individual end points,
 but not recommended, if there are strong secondary currents as encountered at
 bends or bifurcations


\end{lstlisting}
\subsection{plot}
${}$
\begin{lstlisting}
 plot the transect as a line in cartesian coordinates

\end{lstlisting}
\subsection{plot2d}
${}$
\begin{lstlisting}
 plot transects

\end{lstlisting}
\subsection{plot\_rounds}
${}$
\begin{lstlisting}
 plot rounds (consecutiver transects) navigated with the boat

\end{lstlisting}
\subsection{resample}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{xy2nts}
${}$
\begin{lstlisting}

\end{lstlisting}
\section{cross-section/@CrossSection}
\subsection{CrossSection}
${}$
\begin{lstlisting}
 Level-3 ADCP data processing, projection to cross section and integration/averaging

\end{lstlisting}
\subsection{calc\_auxiliary\_quant}
${}$
\begin{lstlisting}
 compute auxiliary quantities

\end{lstlisting}
\subsection{compare}
${}$
\begin{lstlisting}
 interpolate for all cross-sections the values to the same time-slot
 for comparison

\end{lstlisting}
\subsection{determine\_time\_slots}
${}$
\begin{lstlisting}
 split data set into specific time slots

\end{lstlisting}
\subsection{discharge}
${}$
\begin{lstlisting}
 integrate the discharge over all finite elements of the cross section

\end{lstlisting}
\subsection{extrapolate\_S}
${}$
\begin{lstlisting}
 extrapolate missing values along the vertical

\end{lstlisting}
\subsection{extrapolate\_backscatter}
${}$
\begin{lstlisting}
 extrapolate the backscatter

\end{lstlisting}
\subsection{extrapolate\_backscatter\_2d\_STATIC}
${}$
\begin{lstlisting}
 extrapolate backscatter to bed, surface and banks

\end{lstlisting}
\subsection{extrapolate\_bed\_profile}
${}$
\begin{lstlisting}
 extrapolate bed profile to channel banks

\end{lstlisting}
\subsection{extrapolate\_n}
${}$
\begin{lstlisting}
 extrapolate value beyond end of cross section

\end{lstlisting}
\subsection{extrapolate\_velocity}
${}$
\begin{lstlisting}
 extrapolate the velocity to the bank, bed, and surface

\end{lstlisting}
\subsection{extrapolate\_velocity\_1d\_STATIC}
${}$
\begin{lstlisting}
 extrapolate depth averaged velocity

\end{lstlisting}
\subsection{extrapolate\_velocity\_2d\_STATIC}
${}$
\begin{lstlisting}
 extrapolate velocity to banks, surface and bottom
 TODO, this is only applicable for Grid2

\end{lstlisting}
\subsection{fit\_bathymetry\_2d}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{fit\_bed\_profile}
${}$
\begin{lstlisting}
 fit the bed profile, has to precede n-z meshing of the cross-section

\end{lstlisting}
\subsection{fit\_cross\_section}
${}$
\begin{lstlisting}
 fit the optimal cross section as the main axis of the transect
 by regressing a line through the measurement points in the x-y plane

 y = c0 + c1 x

\end{lstlisting}
\subsection{fit\_vertical\_profile\_of\_velocity}
${}$
\begin{lstlisting}
 fit vertical profile of the streamwise velocity

 this function will work with both ensenble data, eg. U_bin taken from ensembles,
 as well as gridded data, (U_bin taken from the velocity grid)

 input
 cs    : struct        : cross section averaged data
 U_bin : [nrow x ncol] : vertical profiles of stream wise velocity
 Z_bin : [nrow x ncol] : positions of bin above bottom for each element in U_bin
 ens.N : [ncolx1]      : position of each column of U in along the cross section
 ens.H : [ncolx1]      : depth of each column of U
 ens.sH  : [ncolx1]     : std of depth at each colum of U
 ens.ldx : [ncolx1]    : last valid sample in column of U
 dw_z0   : scalar    : grid cell size for grid_n
 obj.roughnessmethod           : method to use for the computation
 output:
 grid_n : struct       : function of u_s and z_0 along cross section
 us_ens, ln_z0_ens, U_ens : local estimates for input ensembles/grid columns
            not returned by every obj.roughnessmethod

\end{lstlisting}
\subsection{fit\_water\_level}
${}$
\begin{lstlisting}
 fit water level from depth measurement
 this works only if the ADCP is stationary

\end{lstlisting}
\subsection{generate\_mesh\_tn}
${}$
\begin{lstlisting}
 generate 1+1D mesh over time and across section

\end{lstlisting}
\subsection{generate\_mesh\_tnz}
${}$
\begin{lstlisting}
 generate a t-n-z mesh

\end{lstlisting}
\subsection{optstr}
${}$
\begin{lstlisting}
 string of options, for file name generation

\end{lstlisting}
\subsection{plot\_n\_quiver}
${}$
\begin{lstlisting}
 plot quiver across section

\end{lstlisting}
\subsection{plot\_nz}
${}$
\begin{lstlisting}
 plot along n and z

\end{lstlisting}
\subsection{plot\_nz\_quiver}
${}$
\begin{lstlisting}
 quiver plot of velocity across section

\end{lstlisting}
\subsection{plot\_tn}
${}$
\begin{lstlisting}
 plot over time and across channel

\end{lstlisting}
\subsection{plot\_xyz}
${}$
\begin{lstlisting}
 plot values in "val" in the 2D cross section, where the cartesian
 rather than the local coordinates of the cross-section are used

\end{lstlisting}
\subsection{process\_backscatter}
${}$
\begin{lstlisting}
 process backscatter, i.e. fit to cross-section grid from bin-values

\end{lstlisting}
\subsection{process\_backscatter\_tn}
${}$
\begin{lstlisting}
	process depth integrated backscatter over time t and acrross section N
 note: backscatter is processed as flux
	 due to high concentration and backscatter near the bottom,
	the inner rpoduct of the discharge and concentration
	\bar u \bar c_s is not a good estimate of the 
       depth averaged sediment flux \bar{u c_s} 

\end{lstlisting}
\subsection{process\_backscatter\_tnz}
${}$
\begin{lstlisting}
 process the backscatter in 2+1D (time, across channel and along vertical)

\end{lstlisting}
\subsection{process\_discharge}
${}$
\begin{lstlisting}
 process the discharge

\end{lstlisting}
\subsection{process\_velocity\_tn}
${}$
\begin{lstlisting}
 process the velocity data

\end{lstlisting}
\subsection{process\_velocity\_tnz}
${}$
\begin{lstlisting}
 process velocity data in 2+1D (time, across-section and along vertical)

\end{lstlisting}
\subsection{summarise}
${}$
\begin{lstlisting}
 summarize discharge of cross section

\end{lstlisting}
\subsection{var\_n}
${}$
\begin{lstlisting}
 return value stored in field "fieldname" at position "N" in the cross section

\end{lstlisting}
\subsection{var\_t}
${}$
\begin{lstlisting}
 return value stored in filed "fieldname" at time t
 cross sectionally integrated or averaged value

\end{lstlisting}
\subsection{var\_tn}
${}$
\begin{lstlisting}
 return values of field "fieldname" at time t and position N along cross section
 typically depth integrated or averaged values

\end{lstlisting}
\subsection{var\_tnz}
${}$
\begin{lstlisting}
 generically return value stored in field "fieldname" at time t and position N

\end{lstlisting}
\section{cross-section}
\subsection{complete\_profiles}
${}$
\begin{lstlisting}
 fill gaps in profiles
 assumes profile to be constant in time, this is not true
 for tidal flow in compound cross sections and near banks

\end{lstlisting}
\subsection{define\_transect}
${}$
\begin{lstlisting}
 gui user selection of cross-section end points

\end{lstlisting}
\subsection{discharge\_division}
${}$
\begin{lstlisting}
 discharge division ratio

\end{lstlisting}
\subsection{discharge\_summary}
${}$
\begin{lstlisting}
 compute and store discharge summary
		q_tn = cs.q_tn(ti);
		ndx       = abs(N)<=Nlim;
		Qi        = cs.dw*sum(q_tn)';
		Qi_centre = cs.dw*sum(q_tn(ndx,:))';
		Q = [Q; Qi];
		Q_centre = [Q_centre; Qi_centre];

\end{lstlisting}
\subsection{load\_vadcp\_discharge}
${}$
\begin{lstlisting}
 load previously computed vadcp discharge (auxiliary function for plotting)
 this function stacks data from several vadcp reference measurements into one structure
 This assumes that all data sets where processed with the same settings

\end{lstlisting}
\subsection{split\_transect2}
${}$
\begin{lstlisting}

\end{lstlisting}
\section{hadcp/@HADCP\_Discharge}
\subsection{HADCP\_Discharge}
${}$
\begin{lstlisting}
 superclass for HADCP discharge estimation methods

\end{lstlisting}
\subsection{fit}
${}$
\begin{lstlisting}
 fit the model parameter for HADCP discharge prediction,
 estimate errors with the Jacknife method

\end{lstlisting}
\section{hadcp/@HDischarge}
\subsection{Hbin}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{calc\_specific\_discharge\_weights}
${}$
\begin{lstlisting}
 calculate unite discharge weights

\end{lstlisting}
\subsection{estimate\_discharge}
${}$
\begin{lstlisting}
 integrate and scale specifc discharge to total discharge for each ensemble

\end{lstlisting}
\section{hadcp/@HIVM}
\subsection{HIVM}
${}$
\begin{lstlisting}
 Index velocity method of Horizontal ADCP data

\end{lstlisting}
\section{hadcp/@IVM}
\subsection{IVM}
${}$
\begin{lstlisting}
 index velocity method

\end{lstlisting}
\section{hadcp}
\subsection{ESM}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{ESM\_individual}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{SDM}
${}$
\begin{lstlisting}
 Specific Discharge Method
 upscale specific discharge to cross sectionally integrate discharge,
  than average
 this method is provenly less accurate than averaging before upscaling

\end{lstlisting}
\subsection{VPM}
${}$
\begin{lstlisting}
 velocity profile method
 correct individual bin velocities for vertical velocity profile variation,
 then averagem, then upscale to cross sectionally integrated discharge

\end{lstlisting}
\subsection{hadcp\_homogenize\_profile}
${}$
\begin{lstlisting}
 homogenize the hadcp profile

\end{lstlisting}
\subsection{hadcp\_homogenize\_profile2}
${}$
\begin{lstlisting}
 homogenise the horizontal velocity profile

\end{lstlisting}
\subsection{wavg}
${}$
\begin{lstlisting}
 weighted average ?

\end{lstlisting}
\subsection{wavg\_mean}
${}$
\begin{lstlisting}
 weighted average

\end{lstlisting}
\subsection{wopt}
${}$
\begin{lstlisting}
 optimal weights for averaging (lumped) velocities that are each associated
 with error variance s2

\end{lstlisting}
\section{adcp}
\begin{lstlisting}
adcp : processing of Acoustic Doppler Current Profiler (ADCP) data

Processing in 3 Levels:

Level 0 : Read in of raw-data (externally provided by ADCPtools, Vermeulen et al.)

Level 1 : VADCP, HADCP, SPADCP
	- convert raw data to CI units (m,s,kg)
	- transform velocities to arbitrary coordinate references
	- depth averaging and integration
	- fit velocity profiles
	- convert backscatter to suspended sediment concentration

Level 2 : CrossSection
	- interpolate and integrate for cross sections

Instruction:
	see and run saggau/sanggau_process_discharge for a working example
	to process VADCP discharge at a non-tidal station


\end{lstlisting}
\subsection{smooth\_track}
${}$
\begin{lstlisting}
 smooth a repeatedly navigated (circular) track to produce and idealized
 average track

\end{lstlisting}
\subsection{streawise\_velocity}
${}$
\begin{lstlisting}
 rotate ensembles in stream direction (transverse velocity integrates to zero)

\end{lstlisting}
\section{test}
\subsection{example\_backscatter\_coefficient\_2}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_backscatter\_coefficient}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_bedslope}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_delta\_z\_correction}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_depth\_range}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_linearisation}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_procTrans\_vele}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_rotvel}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_sanggau\_load\_bed\_level\_2016}
${}$
\begin{lstlisting}

\end{lstlisting}
\subsection{test\_sanggau\_rc}
${}$
\begin{lstlisting}

\end{lstlisting}
\section{adcp}
\begin{lstlisting}
adcp : processing of Acoustic Doppler Current Profiler (ADCP) data

Processing in 3 Levels:

Level 0 : Read in of raw-data (externally provided by ADCPtools, Vermeulen et al.)

Level 1 : VADCP, HADCP, SPADCP
	- convert raw data to CI units (m,s,kg)
	- transform velocities to arbitrary coordinate references
	- depth averaging and integration
	- fit velocity profiles
	- convert backscatter to suspended sediment concentration

Level 2 : CrossSection
	- interpolate and integrate for cross sections

Instruction:
	see and run saggau/sanggau_process_discharge for a working example
	to process VADCP discharge at a non-tidal station


\end{lstlisting}
\subsection{zztransform}
${}$
\begin{lstlisting}
 non-linear mapping for bin coordinates when depth averages between ensembles
 for avaraging several ensembles

	preserve discharge w int u_avg dz = int int u dz dn = Q
	perserve shear stress is the same (u_avg)^2_s = mean((u_s)^2)
	preserve sediment transport w int u_avg c_avg dz = int int u c dz dn
      preserve rouse number

	alternative : correct parameters for effects of averaging

 several approaches :
 s-transform : z_1' = H0/H1 z_1, perserves u_bar
                                 does not preserve u_* (du/dz|_0)
 clipping    : z_1' = z_1, z_1 < H0, does not preserve u_bar
				       unclear if H0>H1
                                     perserves (du/dz)_0 (u_*)
 zz-transform : perserve both u_bar and u_
 TODO this is non-monotoneous when difference in H0 and H1 is large

\end{lstlisting}
\end{document}
